define("app/ui/infinitescroll/button",["jquery","pubsub"],function(e){return{_$button:null,_hasMore:!0,init:function(){this._$button=e(".js-listing-infinite-btn"),this._initEvents(),this._initSubscriptions()},_initEvents:function(){this._$button.on("click",{proxy:this},this._processClick)},_initSubscriptions:function(){e.subscribe("/pagination/url",e.proxy(this._showMore,this)),e.subscribe("/listing/complete",e.proxy(this._processNewContentAdded,this))},_updateTextLoading:function(){this._$button.text("Loading...")},_processClick:function(e){e.preventDefault(),e.data.proxy._updateTextLoading(),e.data.proxy._publishNextEvent()},_publishMoreEvent:function(t){e.publish("/listing/more",[{url:t}])},_publishNextEvent:function(){e.publish("/pagination/next")},_showMore:function(e){if(e.url===-1)return;this._hasMore=e.hasMore,this._publishMoreEvent(e.url)},_processNewContentAdded:function(){if(!this._hasMore){this._hideButton(),this._addEndMessage();return}this._showButton()},_addEndMessage:function(){this._$button.after('<p class="bravo heading text-center">There are no more results to show</p>')},_hideButton:function(){this._$button.fadeOut(200)},_showButton:function(){this._$button.text("+ Show More"),this._$button.fadeIn(200)}}}),define("app/ui/infinitescroll/pagination",["jquery","pubsub"],function(e,t){return{_$pagination:null,init:function(){this._getPagination(),this._initSubscriptions(),this._setupAjaxUrls()},_initSubscriptions:function(){e.subscribe("/pagination/next",e.proxy(this._processNext,this)),e.subscribe("/pagination/update",e.proxy(this._processUpdate,this)),e.subscribe("/listing/complete",e.proxy(this._updateFirstPagination,this))},_processUpdate:function(e){this._getPagination(),this._updateValues(e),this._updateSelected(),this._updatePageNumber(),this._insertPagination()},_updateFirstPagination:function(){var t=e(".js-listing-infinite").children("li").length;e(".js-pagination").first().find(".js-pagination-end").text(t)},_processNext:function(){var e=this._getNextPageUrl(),t=this._hasMoreResults(),n={url:e,hasMore:t};this._publishUrlEvent(n)},_getPagination:function(){return this._$pagination=e(".js-pagination").eq(0).clone(),this._$pagination},_updateValues:function(e){this._$pagination.find(".js-pagination-start").text(e.start),this._$pagination.find(".js-pagination-end").text(e.end)},_insertPagination:function(){e(".js-listing-infinite").last().after(this._$pagination)},_getNextPageUrl:function(){var t=e(".js-pagination-pages").eq(0),n=t.find(".is-selected"),r=n.closest("li").next("li").find("a")[0];return r!=undefined?r.href:-1},_hasMoreResults:function(){var t=e(".js-pagination-pages").eq(0);return!!t.find(".is-selected").closest("li").next().next().length},_getPageSize:function(){var e=this._$pagination.find(".js-pagination-pages").attr("data-url"),t=e.substring(e.lastIndexOf("/"),e.length);return parseInt(/\d+/.exec(t)[0],10)},_getPageNumberFromUrl:function(e){var t=/PageNumber=\d+/.exec(e);return t||(t=/page=\d+/.exec(e)),t?/\d+/.exec(t[0])[0]:1},_getNextStartingPoint:function(e){return e*this._getPageSize()-this._getPageSize()+1},_getNewUrl:function(e){var t=this._$pagination.find(".js-pagination-pages").attr("data-url"),n=this._getPageNumberFromUrl(e),r=this._getNextStartingPoint(n),i=t.substring(0,t.lastIndexOf("/")),s=i.substring(0,i.lastIndexOf("/")),o="";return t.indexOf("?")>1&&(o=t.substring(t.indexOf("?"))),s+"/"+r+"/"+this._getPageSize()+o},_setupAjaxUrls:function(){var t=this,n=e(".js-pagination-pages").eq(0);n.find("a").each(function(){var n=e(this);n.attr("href",t._getNewUrl(n.attr("href")))})},_publishUrlEvent:function(t){e.publish("/pagination/url",[t])},_updateSelected:function(){var t=e(".js-pagination-pages").eq(0),n=t.find(".is-selected"),r=n.closest("li").next("li");n.removeClass("is-selected"),r.find("a").addClass("is-selected")},_updatePageNumber:function(){var t=e(".js-pagination-pages").eq(0),n=t.find("li"),r=t.find(".is-selected").closest("li"),i=parseInt(n.index(r),10)+1;this._$pagination.find(".js-pagination-page-number").text(i),this._$pagination.find(".js-pagination-page-number").closest(".js-pagination").addClass("hidden")}}}),define("app/ui/infinitescroll/content",["jquery","pubsub","app/ui/lazyload/lazyload"],function(e,t,n){return{_id:Math.floor(Math.random()*999+1),init:function(){this._initSubscriptions()},_initSubscriptions:function(){e.subscribe("/listing/more",e.proxy(this._processMore,this)),e.subscribe("/ajax/ready/"+this._id,e.proxy(this._processHtml,this))},_processMore:function(t){e.publish("/ajax/get",[{url:t.url,id:this._id}])},_processHtml:function(e){var t;if(!e.html.length)return;t=this._generateData(e.html),this._publishUpdateEvent(t),this._appendContent(e.html),this._postProcessContent(),this._publishCompleteEvent()},_appendContent:function(t){e(".js-pagination").last().after(t)},_generateData:function(t){var n=e(t),r=n.length?parseInt(n.attr("start"),10):0,i=parseInt(n.attr("data-selection"),10),s=n.length?i+r-1:0;return{start:r,end:s}},_publishUpdateEvent:function(t){e.publish("/pagination/update",[t])},_publishCompleteEvent:function(){e.publish("/listing/complete")},_postProcessContent:function(){var t=e(".js-listing-infinite").last();n.loadImages(t),e.publish("/imagegallery/buttons/init",[t]),e.publish("/lightbox/init",[{html:t}]),e.publish("/availability/get")}}}),define("app/ui/ajax/ajax",["jquery","pubsub"],function(e){return{init:function(){e.subscribe("/ajax/get",e.proxy(this._processRequest,this))},_processRequest:function(e){var t=this._generateCallback(e.id,e.callback);this._getContent(e.url,e.id,t)},_generateCallback:function(e,t){var n=this;return t?function(r){n._publishResponseEvent(e,r),t(r)}:function(t){n._publishResponseEvent(e,t)}},_getContent:function(t,n,r){e.ajax({url:t,success:r})},_publishResponseEvent:function(t,n){e.publish("/ajax/ready/"+t,[{html:n}])}}}),define("app/ui/infinitescroll/infinitescroll",["jquery","app/ui/infinitescroll/button","app/ui/infinitescroll/pagination","app/ui/infinitescroll/content","app/ui/ajax/ajax"],function(e,t,n,r,i){return{init:function(){n.init(),r.init(),t.init(),i.init()},unbind:function(){}}});