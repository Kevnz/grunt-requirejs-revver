define(["jquery","pubsub","app/ui/lazyload/lazyload"],function(e,t,n){return{_id:Math.floor(Math.random()*999+1),init:function(){this._initSubscriptions()},_initSubscriptions:function(){e.subscribe("/listing/more",e.proxy(this._processMore,this)),e.subscribe("/ajax/ready/"+this._id,e.proxy(this._processHtml,this))},_processMore:function(t){e.publish("/ajax/get",[{url:t.url,id:this._id}])},_processHtml:function(e){var t;if(!e.html.length)return;t=this._generateData(e.html),this._publishUpdateEvent(t),this._appendContent(e.html),this._postProcessContent(),this._publishCompleteEvent()},_appendContent:function(t){e(".js-pagination").last().after(t)},_generateData:function(t){var n=e(t),r=n.length?parseInt(n.attr("start"),10):0,i=parseInt(n.attr("data-selection"),10),s=n.length?i+r-1:0;return{start:r,end:s}},_publishUpdateEvent:function(t){e.publish("/pagination/update",[t])},_publishCompleteEvent:function(){e.publish("/listing/complete")},_postProcessContent:function(){var t=e(".js-listing-infinite").last();n.loadImages(t),e.publish("/imagegallery/buttons/init",[t]),e.publish("/lightbox/init",[{html:t}]),e.publish("/availability/get")}}});