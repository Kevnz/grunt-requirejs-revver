define(["jquery","pubsub"],function(e){return{_$button:null,_hasMore:!0,init:function(){this._$button=e(".js-listing-infinite-btn"),this._initEvents(),this._initSubscriptions()},_initEvents:function(){this._$button.on("click",{proxy:this},this._processClick)},_initSubscriptions:function(){e.subscribe("/pagination/url",e.proxy(this._showMore,this)),e.subscribe("/listing/complete",e.proxy(this._processNewContentAdded,this))},_updateTextLoading:function(){this._$button.text("Loading...")},_processClick:function(e){e.preventDefault(),e.data.proxy._updateTextLoading(),e.data.proxy._publishNextEvent()},_publishMoreEvent:function(t){e.publish("/listing/more",[{url:t}])},_publishNextEvent:function(){e.publish("/pagination/next")},_showMore:function(e){if(e.url===-1)return;this._hasMore=e.hasMore,this._publishMoreEvent(e.url)},_processNewContentAdded:function(){if(!this._hasMore){this._hideButton(),this._addEndMessage();return}this._showButton()},_addEndMessage:function(){this._$button.after('<p class="bravo heading text-center">There are no more results to show</p>')},_hideButton:function(){this._$button.fadeOut(200)},_showButton:function(){this._$button.text("+ Show More"),this._$button.fadeIn(200)}}});