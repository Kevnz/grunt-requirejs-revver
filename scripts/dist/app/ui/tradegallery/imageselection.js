define(["jquery","app/ui/tradegallery/imagedata","app/ui/tradegallery/imagelibrary","app/util/utils","app/ui/lightbox/loader","evensteven"],function(e,t,n,r,i){function o(){s=e("#selected-images"),s.length&&(u(),s.on("click",".js-media-item-btn",f),e.publish("/lazyload/loadimages",[s]),i.init(),e(".main, .aside").evenSteven())}function u(){var n="";t.getList(function(t){var i=0,s=r.getObjectLength(t);if(!e.isEmptyObject(t)){n+="<div class='listing-info'><div class='listing-info-current'><p>You have selected <strong class='js-image-number'>"+c(s)+"</strong></p></div></div>",n+="<div class='gallery-wrapper'><ul class='list-grid gallery self-clear'>";if(t!==null&&!e.isEmptyObject(t))for(var o in t)t.hasOwnProperty(o)&&(i++,n+=a(i,s,t[o]))}else n+="<div class='listing-info'><div class='listing-info-current'><p>You have no images selected</p></div></div>",n+="<div class='gallery-wrapper'><ul class='list-grid gallery self-clear'>";n+="</ul></div>"}),n&&s.html(n)}function a(e,t,n){var r=Math.ceil(t/3),i="";return i+="<li>",i+="<span class='js-lightbox-single js-lightbox-load'>",i+="<a class='gallery-figure figure-image figure-dark js-lightbox-image' title='"+n.name+"' href='"+n.src+"'>",i+="<img class='lazy-auto' width='190' height='100' alt='"+n.name+"' src='/images/placeholder/lazyload/landscape.png' data-original='"+n.src+".width.190.ashx'>",i+="<noscript><img src='"+n.src+"'/></noscript><span class='media-magnify'>&#xe012;</span>",i+="</a>",i+="</span>",i+="<div class='gallery-item-body'>",i+="<h3 class='gallery-item-heading'>"+n.name+"</h3>",i+="<dl class='list-stacked gallery-item-detail'><dd>"+n.description+"</dd></dl>",i+="<a data-alttext='Add' data-alttitle='Add to selection' title='Remove from selection' href='#' class='js-media-item-btn selected link-cta-minus'",i+=" data-mediafile='"+n.filename+"' data-medianame='"+n.name+"' data-mediasrc='"+n.src+"' data-mediadescription='"+n.description+"'>Remove</a>",i+="</div>",i+="</li>",i}function f(r){r.preventDefault();var i=e(this),s={filename:i.attr("data-mediaFile"),src:i.attr("data-mediaSrc"),name:i.attr("data-mediaName"),description:i.attr("data-mediaDescription")};i.hasClass("selected")?t.removeMediaItem(s):t.addMediaItem(s),n.toggleButtonState(i),i.closest("li").remove(),l()}function l(){t.getList(function(t){var n=r.getObjectLength(t);e(".js-image-number").html(c(n))})}function c(e){return e+" image"+(e==0||e>1?"s":"")}var s;return{init:o}});