define(["jquery","app/ui/tradegallery/imagedata","app/ui/mediaqueries/mediaqueries","app/util/utils","pubsub"],function(e,t,n,r){function u(){i=e("#main-content"),s=e("#selection-status").find("span"),o=e("#request-images");var t=i;a(),f(t),l(),c(),i.on("click",".js-media-item-btn",h),o.on("click",function(t){e(this).is(".disabled")&&(t.stopPropagation(),t.preventDefault())})}function a(){e.subscribe("/imagegallery/buttons/init",f)}function f(n){t.getList(function(t){var r=e(n).find("li");if(r.length>0&&t!==null&&!e.isEmptyObject(t))for(var i=0;i<r.length;i++){var s=r[i],o=e(s).find(".js-media-item-btn"),u=o.attr("data-mediaSrc");for(var a in t)t.hasOwnProperty(a)&&u===t[a].src&&p(o)}})}function l(){var n;t.getList(function(t){t!==null&&!e.isEmptyObject(t)?(n=r.getObjectLength(t),s.text(n),o.removeClass("disabled")):(s.text("0"),o.addClass("disabled"))})}function c(){e(".gallery .gallery-item-body").length&&n.register([{queries:n.queries.medium,shouldDegrade:!0,match:function(){require(["evensteven"],function(e){e(".gallery .gallery-item-body").evenSteven({resize:!0})})},unmatch:function(){require(["evensteven"],function(e){e(".gallery .gallery-item-body").evenSteven("destroy")})}}])}function h(n){n.preventDefault();var r=e(this),s={filename:r.attr("data-mediaFile").replace("'",""),src:r.attr("data-mediaSrc"),name:r.attr("data-mediaName"),description:r.attr("data-mediaDescription")},o=i.find('a[data-mediaFile="'+s.filename+'"]');!r.hasClass("selected")&&t.addMediaItem(s),r.hasClass("selected")&&t.removeMediaItem(s),p(r),r.parents("#colorbox").length&&o.length&&p(o),l()}function p(e){var t=e.text(),n=e.attr("title"),r=e.attr("data-altText"),i=e.attr("data-altTitle");e.toggleClass("selected"),e.toggleClass("link-cta-plus"),e.toggleClass("link-cta-minus"),e.text(r).attr("title",i),e.attr("data-altText",t).attr("data-altTitle",n)}var i,s,o;return{init:u,checkButtons:f,toggleButtonState:p}});