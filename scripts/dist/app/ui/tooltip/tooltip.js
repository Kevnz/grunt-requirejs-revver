define(["jquery","pubsub","tooltip"],function(e){var t;return{subscribe:function(){e.subscribe("/tooltip/custom",function(n){n.width=n.width!="auto"?n.width:"auto",n.showArrow=n.showArrow?!0:!1;var r='<a class="remove ir dark" href="#close">close</a>',i="<h3>"+n.title+"</h3>",s=typeof n.content=="string"?"<p>"+n.content+"</p>":n.content,o=r+i,u=15,a=22;t.length===0?this.initTooltip():this.resetTooltip(),t.html(o).append(e(s)).css({left:"-10000px",width:n.width}).show().on("click","a.remove",function(){hideTooltip()}),this.isInWindow(n.positionX+(n.showArrow?u:0))?n.showArrow?(t.addClass("help smaller before"),n.positionX=n.positionX+u):t.addClass("smaller"):n.showArrow?(t.addClass("help smaller after"),n.positionX=(n.positionXFlip!=undefined?n.positionXFlip:n.positionX)-t.outerWidth()-(n.showArrow?u:0)):(t.addClass("smaller"),n.positionX=n.positionX-t.outerWidth()),n.positionY=n.showArrow?n.positionY-a:n.positionY,t.hide().css({top:n.positionY,left:n.positionX}),t.fadeIn(function(){e(".oldie").length&&this.style.removeAttribute("filter")})})},init:function(){this.subscribe(),this.setUpTitle("dfn"),this.initTooltip(),e(".main").on("mouseover mouseout","dfn",function(e){this.tooltipFunctionality(this,e)})},tooltipFunctionality:function(n,r){var i=e(n);this.resetTooltip();if(r.type==="mouseover"){r.preventDefault();var s=i.parents(".features").length?i.find("img").attr("alt"):n.innerHTML,o=i.parents(".features").length?i.find("p").html():i.data("title"),u=i.height();t.stop(!0,!0).css({top:i.offset().top+u+15,left:i.offset().left}).html(o).fadeIn()}else this.hideTooltip()},setUpTitle:function(t){e(t).each(function(t,n){var r=e(this);r.data("title",this.title),this.title=""})},resetTooltip:function(){t.removeClass("help smaller after before").width("auto").children().hide()},hideTooltip:function(){t.fadeOut()},isInWindow:function(e){var n=document.body.offsetWidth,r=e+t.outerWidth();return n>r?!0:!1},initTooltip:function(){e('<div id="tooltip" class="tooltip"></div>').hide().appendTo("body"),t=e("#tooltip").hide()}}});