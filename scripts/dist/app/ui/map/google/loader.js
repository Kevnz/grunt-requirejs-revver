define(["jquery","pubsub"],function(e){var t=this,n;return{init:function(){t=this,e(document).ready(function(){t._initButton(),t._initEvents(),t._checkForOpenMapUrls()})},destroy:function(){n.off("click"),e(".js-show-on-map").off("click")},_initButton:function(){n=e(".js-map-toggle"),n.show()},_initEvents:function(){n.on("click",this._toggleOrLoadMap),e(".js-show-on-map").on("click",this._toggleOrLoadMap)},_checkForOpenMapUrls:function(){var e,r=window.location.hash;r==="#map-open"&&n.trigger("click"),r.indexOf("#map-open-")>-1&&(e=r.substring("#map-open-".length,r.length),t._loadMapJs(e))},_toggleOrLoadMap:function(n){n.preventDefault();var r=e(this),i=r.is(".js-show-on-map")?r.data("id"):0;if(r.is(".js-map-toggle")&&r.text().indexOf("Loading")>-1)return!1;t._updateButtonText(r),t._updateUrl(i);if(r.is(".js-load-gmap")){t._loadMapJs(i);return}e.publish("/googlemap/toggle",[{ref:i}])},_updateUrl:function(t){var n;if(!t)return;e(".g-map-container").is(":visible")&&t===0?n="":n=t===0?"#map-open":"#map-open-"+t,window.location.hash=n},_updateButtonText:function(t){e.trim(t.text()).toLowerCase().search("open")!==-1&&n.find(".map-button-label").text("Loading Google Map")},_loadMapJs:function(t){require(["goog!maps,2"],function(){require(["app/ui/map/google/controller"],function(n){e(".js-load-gmap").removeClass("js-load-gmap"),n.init(t)})})}}});