define(["jquery","app/ui/mediaqueries/mediaqueries","app/ui/table/table"],function(e,t){return{init:function(){this._initSubscriptions(),this.InitListAvailability()},_initSubscriptions:function(){e.subscribe("/availability/get",e.proxy(this.InitListAvailability,this))},InitListAvailability:function(){var t=this;e("table.has-availability-lookup").filter(":has(.script-required)").each(function(){var n=e(this),r=n.find(".data-row");r.find("td.script-required").html("Fetching Availability...").removeClass(".script-required");var i=n.data("node-id"),s=e("#check-in input").val();s===e("#check-in input").attr("placeholder")&&(s="");var o="",u="{'nodeID': '"+i+"' ,'DateIn': '"+s+"', 'DateOut': '"+o+"' }";e.ajax({type:"POST",url:"/scripts/src/app/availability/Availability.json.aspx/GetAvailabilityHtml",data:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){r.find("td.loading").replaceWith(e.d),t.CheckRows()},error:function(e){r.find("td").html(e.statusText)}})})},CheckRows:function(){e("table#availability tr").each(function(){e(this).find(".no-bookings, .load-error").length>0&&e(this).hide()})},InitDetailAvailability:function(){var n=e(".js-availability.js-single-property");n.find("select").show(),n.show().on("availability.ready",function(){t.initResponsiveTables()}),n.length>0&&this.UpdateRoomsAndAvailabilityPane("?altTemplate=RoomsAndAvailabilityPane&action=BookNow"),e("body").on("click",'.js-availability a[href*="action=BookNow"]',{module:this},function(t){var n;return e(this).attr("href").indexOf("booknow.aspx")>-1?n=e(this).attr("href").replace(/booknow\.aspx/,"RoomsAndAvailabilityPane.aspx").replace(/\#.*/,""):n=e(this).attr("href").replace(/\?/,"?altTemplate=RoomsAndAvailabilityPane&").replace(/\#.*/,""),t.data.module.UpdateRoomsAndAvailabilityPane(n),!1}),e(".js-availability").on("change","select",{module:this},function(t){var n=e(this).val().replace(/\?/,"?altTemplate=RoomsAndAvailabilityPane&").replace(/\#.*/,"");t.data.module.UpdateRoomsAndAvailabilityPane(n)}),e(".js-availability.multiple-properties th").hover(function(){var t=e(this).find(".product-detail div"),n=e(this).find("a").eq(0).attr("href");e(this).find(".product-detail").show(),t.hasClass("loaded")||e.ajax({url:n+"?altTemplate=AvailabilityInfoPane",dataType:"html",success:function(e){t.html(e),t.addClass("loaded")},error:function(e,n,r){t.html("<div class='inner'><h2>Sorry, There was a problem loading this info.</h2><p>"+n+"</p></div>")}})},function(){e(this).find(".product-detail").hide()})},UpdateRoomsAndAvailabilityPane:function(t){e(".js-availability.js-single-property").html("<h2>Loading Availability...</hd>").addClass("open loading enclosure-top"),e.ajax({url:t,complete:function(t,n){e(".js-availability").removeClass("loading").trigger("availability.ready")},success:function(t){e(".js-availability").html(t)},error:function(t,n,r){e(".js-availability").html("")}})}}});